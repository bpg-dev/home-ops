---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: thanos-objstore
spec:
  refreshInterval: 30m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: thanos-objstore
    template:
      engineVersion: v2
      data:
        # Thanos object storage configuration
        # Ref: https://thanos.io/tip/thanos/storage.md/
        objstore.yaml: |
          type: S3
          config:
            bucket: thanos
            endpoint: garage.storage:3900
            region: us-east-1
            insecure: true
            # Garage prefers path-style S3 access
            bucket_lookup_type: path
            access_key: "{{ .S3_ACCESS_KEY_ID }}"
            secret_key: "{{ .S3_SECRET_ACCESS_KEY }}"
  dataFrom:
    - extract:
        key: thanos


