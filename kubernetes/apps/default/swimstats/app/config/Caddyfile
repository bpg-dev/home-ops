:3000 {
    root * /usr/share/caddy

    # API proxy - route to backend on localhost (same pod)
    handle /api/* {
        reverse_proxy localhost:8080
    }

    # SPA - serve static files with fallback to index.html
    # Note: /auth/callback is handled by the React app (client-side OIDC)
    handle {
        try_files {path} /index.html
        file_server
    }

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
    }

    # Compression
    encode gzip

    # Logging
    log {
        output stdout
        format console
    }
}

:2019 {
    respond /health 200
}
