---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rook-ceph-mon
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Owner
  # Extract all fields from the rook-ceph item in 1Password
  # The item should contain fields: admin-secret, mon-secret, ceph-secret, ceph-username, cluster-name, fsid
  dataFrom:
    - extract:
        key: rook-ceph
  refreshInterval: 2h
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rook-csi-cephfs-node
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Map 1Password field names to expected secret key names
        userID: "{{ index . \"csi-cephfs-node-userID\" }}"
        userKey: "{{ index . \"csi-cephfs-node-userKey\" }}"
  # Extract all fields from the rook-ceph item in 1Password
  dataFrom:
    - extract:
        key: rook-ceph
  refreshInterval: 2h15m
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rook-csi-cephfs-provisioner
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Map 1Password field names to expected secret key names
        userID: "{{ index . \"csi-cephfs-provisioner-userID\" }}"
        userKey: "{{ index . \"csi-cephfs-provisioner-userKey\" }}"
  # Extract all fields from the rook-ceph item in 1Password
  dataFrom:
    - extract:
        key: rook-ceph
  refreshInterval: 2h30m
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rook-csi-rbd-node
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Map 1Password field names to expected secret key names
        userID: "{{ index . \"csi-rbd-node-userID\" }}"
        userKey: "{{ index . \"csi-rbd-node-userKey\" }}"
  # Extract all fields from the rook-ceph item in 1Password
  dataFrom:
    - extract:
        key: rook-ceph
  refreshInterval: 2h45m
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: rook-csi-rbd-provisioner
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Map 1Password field names to expected secret key names
        userID: "{{ index . \"csi-rbd-provisioner-userID\" }}"
        userKey: "{{ index . \"csi-rbd-provisioner-userKey\" }}"
  # Extract all fields from the rook-ceph item in 1Password
  dataFrom:
    - extract:
        key: rook-ceph
  refreshInterval: 3h

